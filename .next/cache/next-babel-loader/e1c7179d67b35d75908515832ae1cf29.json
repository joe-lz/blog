{"ast":null,"code":"var __jsx = React.createElement;\nimport Head from 'next/head';\nimport AV from 'leancloud-storage';\nimport dynamic from 'next/dynamic';\nimport { Table, Tag, Space, Switch, notification, Radio, Popover } from 'antd';\nimport { QuestionCircleOutlined } from '@ant-design/icons';\nimport React, { useState, useEffect } from 'react';\nimport styles from './index.module.scss';\nimport Layout from 'src/components/admin/Layout';\nimport priorityArr from 'src/lib/priority';\n\nfunction AdminHome(props) {\n  const {\n    0: userlist,\n    1: setuserlist\n  } = useState([]);\n  const {\n    0: curUserInfo,\n    1: setcurUserInfo\n  } = useState(null);\n  useEffect(() => {\n    // 获取我的授权状态\n    const query = new AV.Query('CMS_UserInfo'); // query.equalTo(\"user\", curUser);\n    // query.include('user')\n\n    query.limit(50);\n    query.descending('createdAt');\n    query.find().then(res => {\n      setuserlist(res);\n    }).catch(err => {\n      console.log({\n        err\n      });\n    });\n  }, []);\n\n  const updateUserInfo = ({\n    userinfo,\n    params\n  }) => {\n    Object.keys(params).map(keyname => {\n      userinfo.set(keyname, params[keyname]);\n      return keyname;\n    });\n    userinfo.save().then(todo => {\n      // 成功保存之后，执行其他逻辑\n      notification.success({\n        message: '操作成功',\n        description: '权限更新成功～'\n      });\n    }, error => {\n      // 异常处理\n      notification.error({\n        message: '操作失败',\n        description: '权限更新失败，请稍后重试～'\n      });\n    });\n  };\n\n  const columns = [{\n    title: '用户名',\n    dataIndex: 'username',\n    key: 'username',\n    render: (res, item) => {\n      const itemJSON = item.toJSON();\n      return __jsx(\"div\", null, itemJSON.nickname);\n    }\n  }, {\n    title: __jsx(\"div\", null, \"\\u6743\\u9650\\u8BBE\\u7F6E\", __jsx(Popover, {\n      placement: \"rightTop\",\n      content: __jsx(\"div\", null, __jsx(Table, {\n        pagination: false,\n        columns: [{\n          title: 'key',\n          dataIndex: 'value',\n          key: 'value',\n          render: (res, item) => {\n            return item.value;\n          }\n        }, {\n          title: '名称',\n          dataIndex: 'label',\n          key: 'label',\n          render: (res, item) => {\n            return item.label;\n          }\n        }, {\n          title: '描述',\n          dataIndex: 'desc',\n          key: 'desc',\n          render: (res, item) => {\n            return item.desc;\n          }\n        }],\n        dataSource: priorityArr,\n        rowKey: record => record.id,\n        style: {\n          width: '100%'\n        }\n      })),\n      title: \"\\u6743\\u9650\\u8BF4\\u660E\"\n    }, __jsx(QuestionCircleOutlined, {\n      style: {\n        marginLeft: 5\n      }\n    }))),\n    dataIndex: 'prioroty',\n    key: 'prioroty',\n    render: (res, item) => __jsx(\"div\", null, __jsx(Radio.Group, {\n      defaultValue: item.toJSON().priority,\n      buttonStyle: \"solid\",\n      style: {},\n      onChange: e => {\n        updateUserInfo({\n          userinfo: item,\n          params: {\n            priority: e.target.value\n          }\n        });\n      }\n    }, priorityArr.map(obj => {\n      return __jsx(Radio.Button, {\n        value: obj.value,\n        key: `${obj.value}_${obj.labbel}`,\n        checked: obj.value === item.toJSON().priority\n      }, obj.label);\n    })))\n  }];\n  return __jsx(Layout, {\n    onChange: params => {\n      setcurUserInfo(params.userinfo);\n    }\n  }, __jsx(\"p\", {\n    className: \"_admin_body_section_title\"\n  }, \"\\u7528\\u6237\\u7BA1\\u7406\"), curUserInfo && curUserInfo.toJSON().priority === 100 ? __jsx(\"div\", {\n    className: \"_admin_body_section_block\"\n  }, __jsx(Table, {\n    columns: columns,\n    dataSource: userlist,\n    rowKey: record => record.id,\n    style: {\n      width: '100%'\n    }\n  })) : __jsx(\"div\", {\n    className: \"_admin_body_section_block\",\n    style: {\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      minHeight: 100\n    }\n  }, \"\\u6682\\u65E0\\u6743\\u9650\\uFF0C\\u8BF7\\u8054\\u7CFB\\u7BA1\\u7406\\u5458\\u5F00\\u901A\\uFF5E\"));\n}\n\nexport default AdminHome;","map":null,"metadata":{},"sourceType":"module"}