{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nvar __jsx = React.createElement;\nimport Head from 'next/head';\nimport AV from 'leancloud-storage';\nimport dynamic from 'next/dynamic';\nimport React, { useState, useEffect } from 'react';\nimport { Tree, Button, notification, Input, Modal, Spin } from 'antd';\nimport styles from './index.module.scss';\nimport Layout from 'src/components/admin/Layout';\nimport NoData from 'src/components/admin/NoData';\nimport ArticleItem from 'src/components/admin/ArticleItem';\nimport { createArticle, getArticleList } from 'src/service/article';\nimport articleStatus from 'src/lib/articleStatus';\nimport { createMenus, updateMenus, getMenusList } from 'src/service/menu';\n\nfunction AdminHome() {\n  var _useState = useState(false),\n      createModalShow = _useState[0],\n      setcreateModalShow = _useState[1];\n\n  var _useState2 = useState(1),\n      status = _useState2[0],\n      setstatus = _useState2[1];\n\n  var _useState3 = useState(false),\n      isSpin = _useState3[0],\n      setisSpin = _useState3[1];\n\n  var _useState4 = useState(''),\n      title = _useState4[0],\n      settitle = _useState4[1]; // const [author, setauthor] = useState('')\n\n\n  var _useState5 = useState([]),\n      articleLists = _useState5[0],\n      setarticleLists = _useState5[1];\n\n  var _useState6 = useState(null),\n      curUserInfo = _useState6[0],\n      setcurUserInfo = _useState6[1];\n\n  var _useState7 = useState(null),\n      curUser = _useState7[0],\n      setcurUser = _useState7[1];\n\n  var curUserInfoItem = curUserInfo ? curUserInfo.toJSON() : null;\n\n  var handleCreate = function handleCreate() {\n    return _regeneratorRuntime.async(function handleCreate$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!title) {\n              _context.next = 6;\n              break;\n            }\n\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(createArticle({\n              title: title,\n              author: curUserInfo,\n              user: curUser\n            }));\n\n          case 3:\n            setcreateModalShow(false); // 获取文章列表\n\n            _context.next = 6;\n            return _regeneratorRuntime.awrap(getList());\n\n          case 6:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var getList = function getList() {\n    var resList;\n    return _regeneratorRuntime.async(function getList$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            setisSpin(true); // 获取文章列表\n\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(getArticleList( // Object.assign({ status }, curUserInfoItem && curUserInfoItem.priority === 100 ? {} : { user: AV.User.current() })\n            Object.assign({\n              status: status,\n              user: AV.User.current()\n            })));\n\n          case 3:\n            resList = _context2.sent;\n            setarticleLists(resList);\n            setisSpin(false);\n\n          case 6:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var handleNavChange = function handleNavChange(params) {\n    return _regeneratorRuntime.async(function handleNavChange$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            setstatus(params.status); // // 获取文章列表\n            // await getList();\n\n          case 1:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }; // useEffect(() => {\n  //   async function fetchData() {\n  //     await getList()\n  //   }\n  //   fetchData()\n  // }, [])\n\n\n  useEffect(function () {\n    // 获取文章列表\n    getList();\n  }, [status, curUserInfo]);\n  return __jsx(Layout, {\n    onChange: function onChange(params) {\n      setcurUserInfo(params.userinfo);\n      setcurUser(params.curUser);\n    }\n  }, __jsx(\"p\", {\n    className: \"_admin_body_section_title\"\n  }, \"\\u6211\\u7684\\u6587\\u7AE0\"), __jsx(\"div\", {\n    className: \"_admin_body_section_block\"\n  }, __jsx(\"div\", {\n    className: \"_admin_body_section_block_nav\"\n  }, articleStatus.map(function (obj) {\n    return __jsx(\"span\", {\n      className: obj.value === status ? '_admin_body_section_block_nav_item_active' : '_admin_body_section_block_nav_item',\n      key: obj.label,\n      onClick: function onClick() {\n        handleNavChange({\n          status: obj.value\n        });\n      }\n    }, obj.label);\n  }))), __jsx(Spin, {\n    spinning: isSpin,\n    tip: \"\\u52A0\\u8F7D\\u4E2D...\"\n  }, __jsx(\"div\", {\n    className: styles.articles\n  }, status === 1 && __jsx(\"div\", {\n    className: styles.articles_add,\n    onClick: function onClick() {\n      setcreateModalShow(true);\n    }\n  }, __jsx(\"div\", {\n    className: styles.articles_add_content\n  }, __jsx(\"p\", {\n    className: styles.icon\n  }, \"+\"), __jsx(\"p\", null, \"\\u65B0\\u7684\\u521B\\u4F5C\"))), articleLists.map(function (obj) {\n    return __jsx(ArticleItem, {\n      key: obj.id,\n      item: obj,\n      onChange: function _callee() {\n        return _regeneratorRuntime.async(function _callee$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return _regeneratorRuntime.awrap(getList());\n\n              case 2:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, null, null, null, Promise);\n      }\n    });\n  }), articleLists && articleLists.length === 0 && status !== 1 ? __jsx(NoData, null) : null, __jsx(Modal, {\n    title: \"\\u521B\\u5EFA\\u6587\\u7AE0\",\n    width: 400,\n    visible: createModalShow,\n    onCancel: function onCancel() {\n      setcreateModalShow(false);\n    },\n    onOk: function onOk() {\n      handleCreate();\n    },\n    okText: \"\\u521B\\u5EFA\",\n    cancelText: \"\\u53D6\\u6D88\"\n  }, __jsx(Input, {\n    style: {\n      margin: '15px 0'\n    },\n    placeholder: \"\\u6587\\u7AE0\\u6807\\u9898\",\n    onChange: function onChange(e) {\n      settitle(e.target.value);\n    }\n  })))));\n}\n\nexport default AdminHome;","map":null,"metadata":{},"sourceType":"module"}