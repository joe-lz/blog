{"ast":null,"code":"var __jsx = React.createElement;\nimport Head from 'next/head';\nimport AV from 'leancloud-storage';\nimport dynamic from 'next/dynamic';\nimport React, { useState, useEffect } from 'react';\nimport { Tree, Button, notification, Input, Modal, Spin } from 'antd';\nimport styles from './index.module.scss';\nimport Layout from 'src/components/admin/Layout';\nimport NoData from 'src/components/admin/NoData';\nimport ArticleItem from 'src/components/admin/ArticleItem';\nimport { createArticle, getArticleList } from 'src/service/article';\nimport articleStatus from 'src/lib/articleStatus';\nimport { createMenus, updateMenus, getMenusList } from 'src/service/menu';\n\nfunction AdminHome() {\n  const {\n    0: createModalShow,\n    1: setcreateModalShow\n  } = useState(false);\n  const {\n    0: status,\n    1: setstatus\n  } = useState(1);\n  const {\n    0: isSpin,\n    1: setisSpin\n  } = useState(false);\n  const {\n    0: title,\n    1: settitle\n  } = useState(''); // const [author, setauthor] = useState('')\n\n  const {\n    0: articleLists,\n    1: setarticleLists\n  } = useState([]);\n  const {\n    0: curUserInfo,\n    1: setcurUserInfo\n  } = useState(null);\n  const {\n    0: curUser,\n    1: setcurUser\n  } = useState(null);\n  const curUserInfoItem = curUserInfo ? curUserInfo.toJSON() : null;\n\n  const handleCreate = async () => {\n    if (title) {\n      await createArticle({\n        title,\n        author: curUserInfo,\n        user: curUser\n      });\n      setcreateModalShow(false); // 获取文章列表\n\n      await getList();\n    }\n  };\n\n  const getList = async () => {\n    setisSpin(true); // 获取文章列表\n\n    const resList = await getArticleList( // Object.assign({ status }, curUserInfoItem && curUserInfoItem.priority === 100 ? {} : { user: AV.User.current() })\n    Object.assign({\n      status,\n      user: AV.User.current()\n    }));\n    setarticleLists(resList);\n    setisSpin(false);\n  };\n\n  const handleNavChange = async params => {\n    setstatus(params.status); // // 获取文章列表\n    // await getList();\n  }; // useEffect(() => {\n  //   async function fetchData() {\n  //     await getList()\n  //   }\n  //   fetchData()\n  // }, [])\n\n\n  useEffect(() => {\n    // 获取文章列表\n    getList();\n  }, [status, curUserInfo]);\n  return __jsx(Layout, {\n    onChange: params => {\n      setcurUserInfo(params.userinfo);\n      setcurUser(params.curUser);\n    }\n  }, __jsx(\"p\", {\n    className: \"_admin_body_section_title\"\n  }, \"\\u6211\\u7684\\u6587\\u7AE0\"), __jsx(\"div\", {\n    className: \"_admin_body_section_block\"\n  }, __jsx(\"div\", {\n    className: \"_admin_body_section_block_nav\"\n  }, articleStatus.map(obj => {\n    return __jsx(\"span\", {\n      className: obj.value === status ? '_admin_body_section_block_nav_item_active' : '_admin_body_section_block_nav_item',\n      key: obj.label,\n      onClick: () => {\n        handleNavChange({\n          status: obj.value\n        });\n      }\n    }, obj.label);\n  }))), __jsx(Spin, {\n    spinning: isSpin,\n    tip: \"\\u52A0\\u8F7D\\u4E2D...\"\n  }, __jsx(\"div\", {\n    className: styles.articles\n  }, status === 1 && __jsx(\"div\", {\n    className: styles.articles_add,\n    onClick: () => {\n      setcreateModalShow(true);\n    }\n  }, __jsx(\"div\", {\n    className: styles.articles_add_content\n  }, __jsx(\"p\", {\n    className: styles.icon\n  }, \"+\"), __jsx(\"p\", null, \"\\u65B0\\u7684\\u521B\\u4F5C\"))), articleLists.map(obj => {\n    return __jsx(ArticleItem, {\n      key: obj.id,\n      item: obj,\n      onChange: async () => {\n        await getList();\n      }\n    });\n  }), articleLists && articleLists.length === 0 && status !== 1 ? __jsx(NoData, null) : null, __jsx(Modal, {\n    title: \"\\u521B\\u5EFA\\u6587\\u7AE0\",\n    width: 400,\n    visible: createModalShow,\n    onCancel: () => {\n      setcreateModalShow(false);\n    },\n    onOk: () => {\n      handleCreate();\n    },\n    okText: \"\\u521B\\u5EFA\",\n    cancelText: \"\\u53D6\\u6D88\"\n  }, __jsx(Input, {\n    style: {\n      margin: '15px 0'\n    },\n    placeholder: \"\\u6587\\u7AE0\\u6807\\u9898\",\n    onChange: e => {\n      settitle(e.target.value);\n    }\n  })))));\n}\n\nexport default AdminHome;","map":null,"metadata":{},"sourceType":"module"}