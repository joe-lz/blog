{"ast":null,"code":"var __jsx = React.createElement;\nimport Head from 'next/head';\nimport AV from 'leancloud-storage';\nimport dynamic from 'next/dynamic';\nimport { Table, Tag, Space, Switch, notification, Radio, Popover } from 'antd';\nimport { QuestionCircleOutlined } from '@ant-design/icons';\nimport React, { useState, useEffect } from 'react';\nimport styles from './index.module.scss';\nimport Layout from 'src/components/admin/Layout';\nimport priorityArr from 'src/lib/priority';\n\nfunction AdminHome(props) {\n  var _useState = useState([]),\n      userlist = _useState[0],\n      setuserlist = _useState[1];\n\n  var _useState2 = useState(null),\n      curUserInfo = _useState2[0],\n      setcurUserInfo = _useState2[1];\n\n  useEffect(function () {\n    // 获取我的授权状态\n    var query = new AV.Query('CMS_UserInfo'); // query.equalTo(\"user\", curUser);\n    // query.include('user')\n\n    query.limit(50);\n    query.descending('createdAt');\n    query.find().then(function (res) {\n      setuserlist(res);\n    })[\"catch\"](function (err) {\n      console.log({\n        err: err\n      });\n    });\n  }, []);\n\n  var updateUserInfo = function updateUserInfo(_ref) {\n    var userinfo = _ref.userinfo,\n        params = _ref.params;\n    Object.keys(params).map(function (keyname) {\n      userinfo.set(keyname, params[keyname]);\n      return keyname;\n    });\n    userinfo.save().then(function (todo) {\n      // 成功保存之后，执行其他逻辑\n      notification.success({\n        message: '操作成功',\n        description: '权限更新成功～'\n      });\n    }, function (error) {\n      // 异常处理\n      notification.error({\n        message: '操作失败',\n        description: '权限更新失败，请稍后重试～'\n      });\n    });\n  };\n\n  var columns = [{\n    title: '用户名',\n    dataIndex: 'username',\n    key: 'username',\n    render: function render(res, item) {\n      var itemJSON = item.toJSON();\n      return __jsx(\"div\", null, itemJSON.nickname);\n    }\n  }, {\n    title: __jsx(\"div\", null, \"\\u6743\\u9650\\u8BBE\\u7F6E\", __jsx(Popover, {\n      placement: \"rightTop\",\n      content: __jsx(\"div\", null, __jsx(Table, {\n        pagination: false,\n        columns: [{\n          title: 'key',\n          dataIndex: 'value',\n          key: 'value',\n          render: function render(res, item) {\n            return item.value;\n          }\n        }, {\n          title: '名称',\n          dataIndex: 'label',\n          key: 'label',\n          render: function render(res, item) {\n            return item.label;\n          }\n        }, {\n          title: '描述',\n          dataIndex: 'desc',\n          key: 'desc',\n          render: function render(res, item) {\n            return item.desc;\n          }\n        }],\n        dataSource: priorityArr,\n        rowKey: function rowKey(record) {\n          return record.id;\n        },\n        style: {\n          width: '100%'\n        }\n      })),\n      title: \"\\u6743\\u9650\\u8BF4\\u660E\"\n    }, __jsx(QuestionCircleOutlined, {\n      style: {\n        marginLeft: 5\n      }\n    }))),\n    dataIndex: 'prioroty',\n    key: 'prioroty',\n    render: function render(res, item) {\n      return __jsx(\"div\", null, __jsx(Radio.Group, {\n        defaultValue: item.toJSON().priority,\n        buttonStyle: \"solid\",\n        style: {},\n        onChange: function onChange(e) {\n          updateUserInfo({\n            userinfo: item,\n            params: {\n              priority: e.target.value\n            }\n          });\n        }\n      }, priorityArr.map(function (obj) {\n        return __jsx(Radio.Button, {\n          value: obj.value,\n          key: \"\".concat(obj.value, \"_\").concat(obj.labbel),\n          checked: obj.value === item.toJSON().priority\n        }, obj.label);\n      })));\n    }\n  }];\n  return __jsx(Layout, {\n    onChange: function onChange(params) {\n      setcurUserInfo(params.userinfo);\n    }\n  }, __jsx(\"p\", {\n    className: \"_admin_body_section_title\"\n  }, \"\\u7528\\u6237\\u7BA1\\u7406\"), curUserInfo && curUserInfo.toJSON().priority === 100 ? __jsx(\"div\", {\n    className: \"_admin_body_section_block\"\n  }, __jsx(Table, {\n    columns: columns,\n    dataSource: userlist,\n    rowKey: function rowKey(record) {\n      return record.id;\n    },\n    style: {\n      width: '100%'\n    }\n  })) : __jsx(\"div\", {\n    className: \"_admin_body_section_block\",\n    style: {\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      minHeight: 100\n    }\n  }, \"\\u6682\\u65E0\\u6743\\u9650\\uFF0C\\u8BF7\\u8054\\u7CFB\\u7BA1\\u7406\\u5458\\u5F00\\u901A\\uFF5E\"));\n}\n\nexport default AdminHome;","map":null,"metadata":{},"sourceType":"module"}