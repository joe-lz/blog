{"ast":null,"code":"import AV from \"leancloud-storage\";\nimport shortid from \"shortid\";\nexport var getMyUserInfo = function getMyUserInfo() {\n  var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  return new Promise(function (resolve, reject) {\n    var query = new AV.Query(\"CMS_UserInfo\");\n    var curUser = AV.User.current();\n    query.equalTo(\"user\", curUser);\n    query.first().then(function (res) {\n      resolve(res);\n    })[\"catch\"](function (err) {\n      reject(err);\n    });\n  });\n};\nexport var createUserInfo = function createUserInfo() {\n  var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  return new Promise(function (resolve, reject) {\n    // 创建userinfo\n    var curUser = AV.User.current();\n    var userinfoObj = new AV.Object(\"CMS_UserInfo\");\n    userinfoObj.set(\"user\", curUser);\n    userinfoObj.set(\"nickname\", curUser.toJSON().username);\n    userinfoObj.set(\"priority\", 1); // 权限等级 默认：1 未授权\n\n    userinfoObj.set(\"shortid\", shortid.generate()); // shortid\n    // 将对象保存到云端\n\n    userinfoObj.save().then(function (todo) {\n      resolve(todo);\n    }, function (error) {\n      // 异常处理\n      reeject(error);\n    });\n  });\n};\nexport var getUserInfoById = function getUserInfoById() {\n  var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  return new Promise(function (resolve, reject) {\n    var query = new AV.Query(\"CMS_UserInfo\");\n    query.get(params.id).then(function (res) {\n      resolve(res);\n    })[\"catch\"](function (err) {\n      reject(err);\n    });\n  });\n};\nexport var updateUserInfo = function updateUserInfo(_ref) {\n  var userinfoItem = _ref.userinfoItem,\n      params = _ref.params;\n  return new Promise(function (resolve, reject) {\n    Object.keys(params).map(function (keyname) {\n      userinfoItem.set(keyname, params[keyname]);\n    });\n    userinfoItem.save().then(function (res) {\n      resolve(res);\n    }, function (error) {\n      // 异常处理\n      reject(error);\n    });\n  });\n}; // 关注\n\nexport var userFollow = function userFollow(_ref2) {\n  var userid = _ref2.userid;\n  return new Promise(function (resolve, reject) {\n    var query = AV.User.current().followeeQuery(); // query.include('followee')\n\n    query.count().then(function (number) {\n      if (number > 50) {\n        reject(\"超过最大关注人数(50人)\");\n      } else {\n        AV.User.current().follow(userid).then(function (res) {\n          resolve(res);\n        }, function (error) {\n          // 异常处理\n          reject(\"关注失败\");\n        });\n      }\n    });\n  });\n}; // 取消关注\n\nexport var userUnFollow = function userUnFollow(_ref3) {\n  var userid = _ref3.userid;\n  return new Promise(function (resolve, reject) {\n    AV.User.current().unfollow(userid).then(function (res) {\n      resolve(res);\n    }, function (error) {\n      // 异常处理\n      reject(error);\n    });\n  });\n}; // 获取我关注的用户列表\n\nexport var userFolloweeList = function userFolloweeList() {\n  return new Promise(function (resolve, reject) {\n    if (!AV.User.current()) {\n      reject([]);\n    } else {\n      var query = AV.User.current().followeeQuery();\n      query.include(\"followee\");\n      query.find().then(function (followees) {\n        //关注的用户列表 followees\n        resolve(followees);\n      });\n    }\n  });\n}; // 获取用户关注数\n\nexport var userFolloweeNumber = function userFolloweeNumber(_ref4) {\n  var userItem = _ref4.userItem;\n  return new Promise(function (resolve, reject) {\n    var query = userItem.followeeQuery();\n    query.count().then(function (number) {\n      resolve(number);\n    });\n  });\n}; // 获取用户粉丝数\n\nexport var userFollowerNumber = function userFollowerNumber(_ref5) {\n  var userItem = _ref5.userItem;\n  return new Promise(function (resolve, reject) {\n    var query = userItem.followerQuery();\n    query.count().then(function (number) {\n      resolve(number);\n    });\n  });\n};","map":null,"metadata":{},"sourceType":"module"}