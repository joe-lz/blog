{"ast":null,"code":"var __jsx = React.createElement;\nimport Head from 'next/head';\nimport AV from 'leancloud-storage';\nimport dynamic from 'next/dynamic';\nimport { Tree, Button, notification, Input, Modal } from 'antd';\nimport { PlusOutlined, DownOutlined, InfoCircleOutlined } from '@ant-design/icons';\nimport React, { useState, useEffect } from 'react'; // import { v4 as uuidv4 } from \"uuid\";\n\nimport shortid from 'shortid';\nimport styles from './index.module.scss';\nimport Layout from 'src/components/admin/Layout';\nimport defaultMenu, { handleformatData } from 'src/lib/defaultMenu';\nimport { createMenus, updateMenus, getMenusList } from 'src/service/menu';\n\nfunction AdminHome() {\n  const {\n    0: curMenuObj,\n    1: setcurMenuObj\n  } = useState(null);\n  const {\n    0: curMenu,\n    1: setcurMenu\n  } = useState([]);\n  const {\n    0: level1Show,\n    1: setlevel1Show\n  } = useState(false);\n  const {\n    0: level1Title,\n    1: setlevel1Title\n  } = useState('');\n  const {\n    0: selectedMenu,\n    1: setselectedMenu\n  } = useState(null);\n  const {\n    0: updateShow,\n    1: setupdateShow\n  } = useState(false);\n  const {\n    0: curUserInfo,\n    1: setcurUserInfo\n  } = useState(null);\n\n  const onSelect = (select, info) => {\n    const obj = {\n      title: info.node.title,\n      key: info.node.key\n    };\n    setselectedMenu(obj);\n    setupdateShow(true);\n  };\n\n  const updateFunction = async newValue => {\n    if (curMenuObj) {\n      await updateMenus({\n        menuItem: curMenuObj,\n        params: {\n          value: newValue\n        }\n      });\n      setupdateShow(false);\n      handleGetMenu();\n      notification.success({\n        message: '更新成功' // description: \"请输入用户名、密码\",\n\n      });\n    }\n  };\n\n  const onDrop = info => {\n    const result = handleformatData(info, curMenu);\n    updateFunction(result);\n  };\n\n  const createLevel1 = async () => {\n    if (!level1Title) {\n      notification.error({\n        message: '请输入标题' // description: \"请输入用户名、密码\",\n\n      });\n      return;\n    }\n\n    const newObj = {\n      title: level1Title,\n      key: shortid.generate()\n    };\n    curMenu.push(newObj);\n    await updateFunction(curMenu);\n    setlevel1Show(false);\n  };\n\n  const handleUpdate = () => {\n    const newcurMenu = curMenu.map(obj1 => {\n      if (obj1.key === selectedMenu.key) {\n        obj1.title = selectedMenu.title;\n      }\n\n      if (obj1.children) {\n        obj1.children.map(obj2 => {\n          if (obj2.key === selectedMenu.key) {\n            obj2.title = selectedMenu.title;\n          }\n\n          return obj2;\n        });\n      }\n\n      return obj1;\n    });\n    updateFunction(newcurMenu);\n  };\n\n  const handleGetMenu = async () => {\n    // 获取菜单\n    const res = await getMenusList();\n\n    if (res) {\n      setcurMenu(res.attributes.value);\n      setcurMenuObj(res);\n    } else {\n      // 创建默认菜单\n      const resMenu = await createMenus();\n      setcurMenu(defaultMenu);\n      setcurMenuObj(resMenu);\n    }\n  };\n\n  useEffect(() => {\n    handleGetMenu();\n  }, []);\n  return __jsx(Layout, {\n    onChange: params => {\n      setcurUserInfo(params.userinfo);\n    }\n  }, curUserInfo && curUserInfo.toJSON().priority === 100 ? __jsx(\"div\", {\n    className: styles.menus\n  }, __jsx(\"p\", {\n    className: \"_admin_body_section_title\"\n  }, \"\\u81EA\\u5B9A\\u4E49\\u83DC\\u5355\"), __jsx(\"div\", {\n    className: \"_admin_body_section_block\",\n    style: {\n      padding: 30\n    }\n  }, __jsx(\"div\", {\n    className: styles.block_waring\n  }, __jsx(InfoCircleOutlined, {\n    style: {\n      color: 'RGBA(53, 90, 207, 1.00)',\n      fontSize: 20\n    }\n  }), __jsx(\"p\", null, \"\\u62D6\\u62FD\\u76EE\\u5F55\\u8FDB\\u884C\\u6392\\u5E8F\\uFF0C\\u548C\\u5C42\\u7EA7\\u7BA1\\u7406\")), __jsx(Tree, {\n    showLine: true // switcherIcon={<DownOutlined />}\n    ,\n    defaultExpandAll: true,\n    onSelect: onSelect,\n    onDrop: onDrop,\n    draggable: true // blockNode\n    ,\n    treeData: curMenu\n  })), __jsx(\"div\", null, __jsx(Button, {\n    type: \"primary\",\n    shape: \"round\",\n    icon: __jsx(PlusOutlined, null),\n    size: 14,\n    style: {\n      marginRight: 15\n    },\n    onClick: () => {\n      setlevel1Show(true);\n    }\n  }, \"\\u4E00\\u7EA7\\u76EE\\u5F55\")), __jsx(Modal, {\n    title: \"\\u4E00\\u7EA7\\u76EE\\u5F55\",\n    visible: level1Show,\n    onCancel: () => {\n      setlevel1Show(false);\n    },\n    onOk: () => {\n      createLevel1();\n    }\n  }, __jsx(Input, {\n    placeholder: \"\\u6807\\u9898\",\n    onChange: e => {\n      setlevel1Title(e.target.value);\n    }\n  })), __jsx(Modal, {\n    title: \"\\u66F4\\u65B0\",\n    visible: updateShow,\n    onCancel: () => {\n      setupdateShow(false);\n    },\n    onOk: () => {\n      handleUpdate();\n    },\n    okText: \"\\u521B\\u5EFA\",\n    cancelText: \"\\u53D6\\u6D88\"\n  }, __jsx(Input, {\n    placeholder: \"\\u6807\\u9898\",\n    value: selectedMenu ? selectedMenu.title : '',\n    onChange: e => {\n      setselectedMenu({\n        title: e.target.value,\n        key: selectedMenu.key\n      });\n    }\n  }))) : __jsx(\"div\", {\n    className: \"_admin_body_section_block\",\n    style: {\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      minHeight: 100\n    }\n  }, \"\\u6682\\u65E0\\u6743\\u9650\\uFF0C\\u8BF7\\u8054\\u7CFB\\u7BA1\\u7406\\u5458\\u5F00\\u901A\\uFF5E\"));\n}\n\nexport default AdminHome;","map":null,"metadata":{},"sourceType":"module"}