{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nvar __jsx = React.createElement;\nimport Head from 'next/head';\nimport Link from 'next/link';\nimport React, { useState, useEffect } from 'react';\nimport AV from 'leancloud-storage';\nimport dynamic from 'next/dynamic';\nimport shortid from 'shortid';\nimport styles from './index.module.scss';\nvar Nav = dynamic(function () {\n  return import('src/components/admin/Nav');\n}, {\n  ssr: false,\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('src/components/admin/Nav')];\n    },\n    modules: ['src/components/admin/Nav']\n  }\n});\nvar Login = dynamic(function () {\n  return import('src/components/admin/Login');\n}, {\n  ssr: false,\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('src/components/admin/Login')];\n    },\n    modules: ['src/components/admin/Login']\n  }\n});\nvar BodyContent = dynamic(function () {\n  return import('src/components/admin/BodyContent');\n}, {\n  ssr: false,\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('src/components/admin/BodyContent')];\n    },\n    modules: ['src/components/admin/BodyContent']\n  }\n});\nimport { createProfile, getProfileList, updateProfile } from 'src/service/profile';\nimport { getMyUserInfo } from 'src/service/user';\nComponents.defaultProps = {\n  onChange: function onChange() {},\n  hideSidebar: false,\n  bodyStyle: {}\n};\n\nfunction Components(props) {\n  var _useState = useState(AV.User.current()),\n      curUser = _useState[0],\n      setcurUser = _useState[1];\n\n  var _useState2 = useState(null),\n      userinfo = _useState2[0],\n      setuserinfo = _useState2[1];\n\n  var _useState3 = useState(null),\n      profile = _useState3[0],\n      setprofile = _useState3[1]; // 获取博客设置资料\n\n\n  var getProfile = function getProfile() {\n    getProfileList().then(function (res) {\n      if (res) {\n        setprofile(res);\n      } else {\n        createProfile().then(function (resCreate) {\n          setprofile(resCreate);\n        });\n      }\n    });\n  }; // 获取当前用户资料\n\n\n  var fetchUserInfo = function fetchUserInfo() {\n    var res_userinfo, userinfoObj;\n    return _regeneratorRuntime.async(function fetchUserInfo$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(getMyUserInfo());\n\n          case 2:\n            res_userinfo = _context.sent;\n\n            if (res_userinfo) {\n              setuserinfo(res_userinfo);\n            } else {\n              // 创建userinfo\n              userinfoObj = new AV.Object('CMS_UserInfo');\n              userinfoObj.set('user', curUser);\n              userinfoObj.set('nickname', curUser.toJSON().username);\n              userinfoObj.set('priority', 1); // 权限等级 默认：1 未授权\n\n              userinfoObj.set('shortid', shortid.generate()); // shortid\n              // 将对象保存到云端\n\n              userinfoObj.save().then(function (todo) {\n                // 成功保存之后，执行其他逻辑\n                fetchUserInfo();\n              }, function (error) {// 异常处理\n              });\n            }\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  useEffect(function () {\n    getProfile();\n\n    if (curUser) {\n      fetchUserInfo();\n    }\n  }, []);\n  useEffect(function () {\n    props.onChange && props.onChange({\n      curUser: curUser,\n      profile: profile,\n      userinfo: userinfo\n    });\n  }, [curUser, profile, userinfo]);\n  return __jsx(\"div\", {\n    className: styles.container\n  }, __jsx(Head, null, __jsx(\"title\", null, \"\\u7BA1\\u7406\\u540E\\u53F0\")), __jsx(Nav, {\n    type: \"login\",\n    curUser: curUser,\n    userinfo: userinfo,\n    profile: profile\n  }), __jsx(\"div\", {\n    className: styles.body,\n    style: props.bodyStyle\n  }, !curUser && __jsx(Login, {\n    profile: profile\n  }), curUser && __jsx(BodyContent, {\n    priority: userinfo ? userinfo.toJSON().priority : 0,\n    userinfo: userinfo,\n    hideSidebar: props.hideSidebar\n  }, props.children)));\n}\n\nexport default Components;","map":null,"metadata":{},"sourceType":"module"}