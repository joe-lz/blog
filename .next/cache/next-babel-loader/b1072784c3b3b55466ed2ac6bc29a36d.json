{"ast":null,"code":"var __jsx = React.createElement;\nimport Head from 'next/head';\nimport AV from 'leancloud-storage';\nimport dynamic from 'next/dynamic';\nimport { Table, Tag, Space, Switch, notification, Radio, Popover, Modal, Button } from 'antd';\nimport { QuestionCircleOutlined } from '@ant-design/icons';\nimport React, { useState, useEffect } from 'react';\nimport styles from './index.module.scss';\nimport Layout from 'src/components/admin/Layout';\nimport AdForm from 'src/components/admin/AdForm';\nimport { createProfile, getProfileList, updateProfile } from 'src/service/profile';\nimport defaultAd from 'src/lib/defaultAd';\n\nfunction AdminHome(props) {\n  const {\n    0: curUserInfo,\n    1: setcurUserInfo\n  } = useState(null);\n  const {\n    0: profile,\n    1: setprofile\n  } = useState(null);\n  const {\n    0: adValues,\n    1: setadValues\n  } = useState([]); // 获取资料\n\n  const getProfile = () => {\n    getProfileList().then(res => {\n      if (res) {\n        setprofile(res);\n\n        if (res.attributes.ads && res.attributes.ads.length > 0) {\n          setadValues(res.attributes.ads);\n        } else {\n          setadValues(defaultAd);\n        }\n      } else {\n        createProfile().then(resCreate => {\n          setprofile(resCreate);\n\n          if (resCreate.attributes.ads && resCreate.attributes.ads.length > 0) {\n            setadValues(res.attributes.ads);\n          } else {\n            setadValues(defaultAd);\n          }\n        });\n      }\n    });\n  };\n\n  const updateAdArr = ({\n    index,\n    value\n  }) => {\n    let newArr = adValues;\n    newArr[index] = value;\n    setadValues(newArr);\n  }; // 更新profile\n\n\n  const handlesubmit = async () => {\n    await updateProfile({\n      profileItem: profile,\n      params: {\n        ads: adValues\n      }\n    });\n    getProfile();\n    notification.success({\n      message: '更新成功' // description: \"请输入用户名、密码\",\n\n    });\n  };\n\n  useEffect(() => {\n    getProfile();\n  }, []);\n  return __jsx(Layout, {\n    onChange: params => {\n      setcurUserInfo(params.userinfo);\n    }\n  }, __jsx(\"p\", {\n    className: \"_admin_body_section_title\"\n  }, \"\\u5E7F\\u544A\\u8BBE\\u7F6E\"), curUserInfo && curUserInfo.toJSON().priority === 100 && profile ? __jsx(\"div\", {\n    className: styles.ad\n  }, adValues.map((obj, index) => {\n    return __jsx(AdForm, {\n      key: obj.key,\n      id: obj.key,\n      show: obj.show,\n      label: obj.label,\n      title: obj.title,\n      adUrl: obj.adUrl,\n      imgUrl: obj.imgUrl,\n      onChange: e => {\n        updateAdArr({\n          index,\n          value: e\n        });\n      }\n    });\n  }), __jsx(Button, {\n    type: \"primary\",\n    size: \"large\",\n    onClick: () => {\n      handlesubmit();\n    }\n  }, \"\\u4FDD\\u5B58\")) : __jsx(\"div\", {\n    className: \"_admin_body_section_block\",\n    style: {\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      minHeight: 100\n    }\n  }, \"\\u6682\\u65E0\\u6743\\u9650\\uFF0C\\u8BF7\\u8054\\u7CFB\\u7BA1\\u7406\\u5458\\u5F00\\u901A\\uFF5E\"));\n}\n\nexport default AdminHome;","map":null,"metadata":{},"sourceType":"module"}