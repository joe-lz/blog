{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nvar __jsx = React.createElement;\nimport Head from 'next/head';\nimport AV from 'leancloud-storage';\nimport dynamic from 'next/dynamic';\nimport { Table, Tag, Space, Switch, notification, Radio, Popover, Modal, Button } from 'antd';\nimport { QuestionCircleOutlined } from '@ant-design/icons';\nimport React, { useState, useEffect } from 'react';\nimport styles from './index.module.scss';\nimport Layout from 'src/components/admin/Layout';\nimport AdForm from 'src/components/admin/AdForm';\nimport { createProfile, getProfileList, updateProfile } from 'src/service/profile';\nimport defaultAd from 'src/lib/defaultAd';\n\nfunction AdminHome(props) {\n  var _useState = useState(null),\n      curUserInfo = _useState[0],\n      setcurUserInfo = _useState[1];\n\n  var _useState2 = useState(null),\n      profile = _useState2[0],\n      setprofile = _useState2[1];\n\n  var _useState3 = useState([]),\n      adValues = _useState3[0],\n      setadValues = _useState3[1]; // 获取资料\n\n\n  var getProfile = function getProfile() {\n    getProfileList().then(function (res) {\n      if (res) {\n        setprofile(res);\n\n        if (res.attributes.ads && res.attributes.ads.length > 0) {\n          setadValues(res.attributes.ads);\n        } else {\n          setadValues(defaultAd);\n        }\n      } else {\n        createProfile().then(function (resCreate) {\n          setprofile(resCreate);\n\n          if (resCreate.attributes.ads && resCreate.attributes.ads.length > 0) {\n            setadValues(res.attributes.ads);\n          } else {\n            setadValues(defaultAd);\n          }\n        });\n      }\n    });\n  };\n\n  var updateAdArr = function updateAdArr(_ref) {\n    var index = _ref.index,\n        value = _ref.value;\n    var newArr = adValues;\n    newArr[index] = value;\n    setadValues(newArr);\n  }; // 更新profile\n\n\n  var handlesubmit = function handlesubmit() {\n    return _regeneratorRuntime.async(function handlesubmit$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(updateProfile({\n              profileItem: profile,\n              params: {\n                ads: adValues\n              }\n            }));\n\n          case 2:\n            getProfile();\n            notification.success({\n              message: '更新成功' // description: \"请输入用户名、密码\",\n\n            });\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  useEffect(function () {\n    getProfile();\n  }, []);\n  return __jsx(Layout, {\n    onChange: function onChange(params) {\n      setcurUserInfo(params.userinfo);\n    }\n  }, __jsx(\"p\", {\n    className: \"_admin_body_section_title\"\n  }, \"\\u5E7F\\u544A\\u8BBE\\u7F6E\"), curUserInfo && curUserInfo.toJSON().priority === 100 && profile ? __jsx(\"div\", {\n    className: styles.ad\n  }, adValues.map(function (obj, index) {\n    return __jsx(AdForm, {\n      key: obj.key,\n      id: obj.key,\n      show: obj.show,\n      label: obj.label,\n      title: obj.title,\n      adUrl: obj.adUrl,\n      imgUrl: obj.imgUrl,\n      onChange: function onChange(e) {\n        updateAdArr({\n          index: index,\n          value: e\n        });\n      }\n    });\n  }), __jsx(Button, {\n    type: \"primary\",\n    size: \"large\",\n    onClick: function onClick() {\n      handlesubmit();\n    }\n  }, \"\\u4FDD\\u5B58\")) : __jsx(\"div\", {\n    className: \"_admin_body_section_block\",\n    style: {\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      minHeight: 100\n    }\n  }, \"\\u6682\\u65E0\\u6743\\u9650\\uFF0C\\u8BF7\\u8054\\u7CFB\\u7BA1\\u7406\\u5458\\u5F00\\u901A\\uFF5E\"));\n}\n\nexport default AdminHome;","map":null,"metadata":{},"sourceType":"module"}